<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lukapis Click Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0a0a0c; color: #ffffff; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .tap-target { transition: all 0.05s ease; cursor: pointer; user-select: none; }
        .tap-target:active { transform: scale(0.96); background: rgba(255, 255, 255, 0.08); }
        .neon-blue { text-shadow: 0 0 15px rgba(59, 130, 246, 0.5); color: #60a5fa; }
        .neon-green { text-shadow: 0 0 15px rgba(16, 185, 129, 0.5); color: #34d399; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-6">

    <div class="max-w-md w-full space-y-6">
        <div class="glass rounded-3xl p-4 flex items-center justify-between">
            <label class="text-xs font-bold text-gray-500 uppercase ml-2">Start From</label>
            <div class="flex items-center gap-2">
                <input type="number" id="start-val-input" value="0" 
                       class="bg-transparent border-b border-gray-700 w-40 text-center text-lg font-bold focus:border-blue-500 outline-none transition">
                <button onclick="applyAndReset()" class="bg-blue-600 hover:bg-blue-500 text-[10px] font-black px-3 py-2 rounded-full transition uppercase">Apply</button>
            </div>
        </div>

        <div id="trigger" class="tap-target glass rounded-[2.5rem] p-12 text-center shadow-2xl">
            <span class="text-xs font-black tracking-[0.3em] text-gray-500 uppercase">Total Taps</span>
            <div id="count-display" class="text-9xl font-black my-4">0</div>
            <p class="text-gray-500 text-xs">Tap to measure rhythm</p>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="glass rounded-3xl p-6">
                <p class="text-[10px] text-gray-500 font-bold mb-1 uppercase">Last Interval</p>
                <div class="text-3xl font-mono neon-blue">
                    <span id="last-time">0.000</span><span class="text-xs ml-1 opacity-50">s</span>
                </div>
            </div>
            <div class="glass rounded-3xl p-6">
                <p class="text-[10px] text-gray-500 font-bold mb-1 uppercase">Average</p>
                <div class="text-3xl font-mono neon-green">
                    <span id="avg-time">0.000</span><span class="text-xs ml-1 opacity-50">s</span>
                </div>
            </div>
        </div>

        <div class="mt-8 space-y-2 text-center">
            <p class="text-[10px] text-gray-700 uppercase tracking-[0.2em]">Data persisted in local storage</p>
            <p class="text-[10px] text-blue-500/50 font-medium uppercase tracking-[0.1em]">
                Developed by Lukaglyph | Powered by Vibe Coding
            </p>
        </div>
    </div>

    <script>
        // 初期値を 0 に変更
        let baseValue = parseInt(localStorage.getItem('userInitialValue')) || 0;
        let count = baseValue;
        let lastTime = null;
        let totalIntervals = 0;
        let sumIntervals = 0;

        const countDisplay = document.getElementById('count-display');
        const startInput = document.getElementById('start-val-input');
        const lastDisplay = document.getElementById('last-time');
        const avgDisplay = document.getElementById('avg-time');
        const trigger = document.getElementById('trigger');

        startInput.value = baseValue;
        countDisplay.textContent = baseValue;

        function applyAndReset() {
            const newVal = parseInt(startInput.value);
            if (isNaN(newVal)) return;
            
            baseValue = newVal;
            localStorage.setItem('userInitialValue', baseValue);
            
            resetStats();
        }

        function resetStats() {
            count = baseValue;
            lastTime = null;
            totalIntervals = 0;
            sumIntervals = 0;
            
            countDisplay.textContent = count;
            countDisplay.style.color = '#ffffff';
            lastDisplay.textContent = "0.000";
            avgDisplay.textContent = "0.000";
        }

        trigger.addEventListener('pointerdown', (e) => {
            const now = performance.now();
            
            // カウントを増加 (count++) に変更
            count++;
            countDisplay.textContent = count;
            // 0以上なので赤色にする条件を外す、または別の条件に変更可能
            countDisplay.style.color = '#ffffff';

            if (lastTime !== null) {
                const interval = (now - lastTime) / 1000;
                totalIntervals++;
                sumIntervals += interval;

                lastDisplay.textContent = interval.toFixed(3);
                avgDisplay.textContent = (sumIntervals / totalIntervals).toFixed(3);
            }

            lastTime = now;
        });
    </script>
</body>
</html>
